{"version":3,"sources":["../../src/snapshot/redis_storage.js"],"names":["redisConfig","get","_password","password","_hkey","_client","createClient","on","err","spec","resolve","reject","hkeys","replies","length","dto","_commit","functionName","auth"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;AAGA;;;;;;;AAGE,oBAAc;AAAA;;AACZ,QAAIA,cAAc,iBAAOC,GAAP,CAAW,OAAX,CAAlB;AACA,SAAKC,SAAL,GAAiBF,YAAYG,QAA7B;AACA,SAAKC,KAAL,GAAa,eAAb;AACA,SAAKC,OAAL,GAAe,gBAAMC,YAAN,CAAmBN,WAAnB,CAAf;AACA,SAAKK,OAAL,CAAaE,EAAb,CAAgB,OAAhB,EAAyB,UAAUC,GAAV,EAAe;AACtC,sBAAI,WAAWA,GAAf;AACD,KAFD;AAGD;;;;0BAEKC,I,EAAM;AACV,aAAO,sBAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5C,aAAKN,OAAL,CAAaO,KAAb,CAAmB,KAAKR,KAAxB,EAA+B,UAAUI,GAAV,EAAeK,OAAf,EAAwB;AACrD,cAAIL,GAAJ,EAASG,OAAOH,GAAP;AACTE,kBAAQG,QAAQC,MAAhB;AACD,SAHD;AAID,OALM,CAAP;AAMD;;AAED;;;;0BACML,I,EAAM,CAEX;;;2BAEMM,G,EAAKN,I,EAAM,CAEjB;;;0BAEKM,G,EAAK,CAEV;;;6BAEQ;AACP,UAAIC,UAAU,SAASC,YAAT,GAAwB,CAErC,CAFD;AAGA,UAAI,KAAKf,SAAT,EAAoB;AAClB,aAAKG,OAAL,CAAaa,IAAb,CAAkB,KAAKhB,SAAvB,EAAkC,YAAY,CAE7C,CAFD;AAGD,OAJD,MAIO,CAEN;AACF;;;+BAEU,CAEV","file":"redis_storage.js","sourcesContent":["import redis from \"redis\";\r\nimport {\r\n  log\r\n} from '../utils';\r\nimport config from '../config';\r\n\r\nexport default class {\r\n  constructor() {\r\n    let redisConfig = config.get('redis');\r\n    this._password = redisConfig.password;\r\n    this._hkey = 'cqrs_snapshot';\r\n    this._client = redis.createClient(redisConfig);\r\n    this._client.on(\"error\", function (err) {\r\n      log(\"Error \" + err);\r\n    });\r\n  }\r\n\r\n  count(spec) {\r\n    return new Promise(function (resolve, reject) {\r\n      this._client.hkeys(this._hkey, function (err, replies) {\r\n        if (err) reject(err);\r\n        resolve(replies.length);\r\n      });\r\n    });\r\n  }\r\n\r\n  // select first\r\n  first(spec) {\r\n\r\n  }\r\n\r\n  update(dto, spec) {\r\n\r\n  }\r\n\r\n  inert(dto) {\r\n\r\n  }\r\n\r\n  commit() {\r\n    let _commit = function functionName() {\r\n\r\n    };\r\n    if (this._password) {\r\n      this._client.auth(this._password, function () {\r\n\r\n      });\r\n    } else {\r\n\r\n    }\r\n  }\r\n\r\n  rollback() {\r\n\r\n  }\r\n}\r\n"]}