{"version":3,"sources":["../../src/config/index.js"],"names":["rootConfig","__dirname","configCache","options","configPath","appPath","initConfig","name","moduleConfigPath","filename","json","filename2","json2","filename3","json3"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;kBAMe;AACb,oBAAc;AAAA;;AACZ,SAAKA,UAAL,GAAkBC,SAAlB;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACD;;AAJY;AAAA;AAAA,yBAMRC,OANQ,EAMC;AACZA,gBAAUA,WAAW,EAArB;AACA,WAAKC,UAAL,GAAkBD,QAAQC,UAA1B;AACA,WAAKC,OAAL,GAAeF,QAAQE,OAAvB;AACA,WAAKC,UAAL,GAAkB,sBAAc,EAAd,EAAkBH,OAAlB,CAAlB;AACD;AAXY;AAAA;AAAA,4BAaL;AACN,WAAKD,WAAL,GAAmB,EAAnB;AACD;;AAED;;AAjBa;AAAA;AAAA,wBAkBTK,IAlBS,EAkBHC,gBAlBG,EAkBe;AAC1BD,aAAOA,QAAQ,QAAf;AACA,UAAI,KAAKL,WAAL,CAAiBK,IAAjB,CAAJ,EACE,OAAO,KAAKL,WAAL,CAAiBK,IAAjB,CAAP;AACF,UAAIE,WAAW,KAAKT,UAAL,gBAAwBO,IAAxB,GAA+B,KAA9C;AACA,UAAIG,OAAO,wBAAYD,QAAZ,KAAyB,EAApC;AACA,UAAI,KAAKL,UAAT,EAAqB;AACnB,YAAIO,YAAY,KAAKP,UAAL,gBAAwBG,IAAxB,GAA+B,KAA/C;AACA,YAAI,mBAAOI,SAAP,CAAJ,EAAuB;AACrB,cAAIC,QAAQ,wBAAYD,SAAZ,CAAZ;AACA,gCAAcD,IAAd,EAAoBE,KAApB;AACD;AACF;AACD,UAAIJ,gBAAJ,EAAsB;AACpB,YAAIK,YAAYL,gCAAyBD,IAAzB,GAAgC,KAAhD;AACA,YAAI,mBAAOM,SAAP,CAAJ,EAAuB;AACrB,cAAIC,QAAQ,wBAAYD,SAAZ,CAAZ;AACA,gCAAcH,IAAd,EAAoBI,KAApB;AACD;AACF;AACD,UAAI,KAAKR,UAAL,IAAmB,KAAKA,UAAL,CAAgBC,IAAhB,CAAvB,EAA8C;AAC5C,8BAAcG,IAAd,EAAoB,KAAKJ,UAAL,CAAgBC,IAAhB,CAApB;AACD;AACD,WAAKL,WAAL,CAAiBK,IAAjB,IAAyBG,IAAzB;AACA,aAAOA,IAAP;AACD;AA3CY;AAAA;AAAA,M","file":"index.js","sourcesContent":["import {\r\n  safeRequire,\r\n  sep,\r\n  exists\r\n} from '../utils';\r\n\r\nexport default new class {\r\n  constructor() {\r\n    this.rootConfig = __dirname;\r\n    this.configCache = {};\r\n  }\r\n\r\n  init(options) {\r\n    options = options || {};\r\n    this.configPath = options.configPath;\r\n    this.appPath = options.appPath;\r\n    this.initConfig = Object.assign({}, options);\r\n  }\r\n\r\n  clear() {\r\n    this.configCache = {};\r\n  }\r\n\r\n  // 加载三级配置，cqrs->globalconfig->modduleconfig\r\n  get(name, moduleConfigPath) {\r\n    name = name || 'config';\r\n    if (this.configCache[name])\r\n      return this.configCache[name];\r\n    let filename = this.rootConfig + sep + name + '.js';\r\n    let json = safeRequire(filename) || {};\r\n    if (this.configPath) {\r\n      let filename2 = this.configPath + sep + name + '.js';\r\n      if (exists(filename2)) {\r\n        let json2 = safeRequire(filename2);\r\n        Object.assign(json, json2);\r\n      }\r\n    }\r\n    if (moduleConfigPath) {\r\n      let filename3 = moduleConfigPath + sep + name + '.js';\r\n      if (exists(filename3)) {\r\n        let json3 = safeRequire(filename3);\r\n        Object.assign(json, json3);\r\n      }\r\n    }\r\n    if (this.initConfig && this.initConfig[name]) {\r\n      Object.assign(json, this.initConfig[name]);\r\n    }\r\n    this.configCache[name] = json;\r\n    return json;\r\n  }\r\n}();\r\n"]}